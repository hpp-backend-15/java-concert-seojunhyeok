# Chapter 2 회고록
## 구현 내용
### 콘서트 예약 API & 단위, 통합 테스트   
### 동시성 처리
### RDB를 사용한 대기열 구현(토큰 만료된 사용자만큼 대기열 통과하는 방식)
## 학습 내용
### Filter & Interceptor
필터는 서블릿 컨테이너 레벨에서 전역적으로 작동하기 때문에,  
특정 컨트롤러나 메서드에 대한 세밀한 요청 제어를 위해 인터셉터를 사용하는 것이 적절하다.   
이번 대기열 토큰 검증에서는 인터셉터를 활용하여 특정 컨트롤러의 요청에 대해서만 토큰 검증을 수행하도록 설정했다.

### 대기열 도입 이유
대기열은 순간적으로 DB 접속이 많아지는 것을 방지하기 위함이다.   
따라서 모든 API에 대기열을 적용할 필요는 없다.   
콘서트 예약의 경우 좌석이 최대 50개이므로, 결제 단계까지 오는 사용자는 최대 50명일 것이다.   
이러한 경우 결제 API에는 대기열을 적용하지 않아도 큰 부하가 없다.
대기열 도입 이유를 생각하고 위와 같은 상황을 고려하여 적절한 API 요청에만 대기열을 설정하는 것도 중요하다.

### 동시성 처리를 위한 락 선정
특정 요청 하나만 허용하고 나머지 요청들을 거부하는 경우.   
충돌이 많이 발생하더라도 낙관적 락 적용을 고민해 볼 수 있다.   
이번 과제를 수행하며 좌석 예약 부분에서 낙관적 락을 적용하려 했지만,   
동시성 테스트를 통과하지 못해 비관적 락을 사용하였다.

### 커스텀 예외 정의 및 예외 핸들링
커스텀 예외를 사용하지 않는 이유는 관리가 되지 않을 가능성 때문이다.   
대부분의 경우 커스텀 예외를 사용하는 것을 권장한다.   
커스텀 예외 사용 시, 예외를 명확히 나타낼 수 있고 비용을 줄일 수 있다.   
스택 트레이스를 생성하는 것 자체가 비용이기 때문.   

무엇보다 앞서 일관성이 중요하다.   
회사에서 커스텀 예외를 사용한다면, 나도 사용하는 방향으로 개발한다.   
기본 예외만을 사용한다면 기본 예외만 사용한다.